!function(t){function i(t,i,h,s){var o;o=i?new e(t,0,h,s):new n(t,0,h,s),this.root=o}function e(t,i,e,n){this._bounds=t,this.children=[],this.nodes=[],n&&(this._maxChildren=n),e&&(this._maxDepth=e),i&&(this._depth=i)}function n(t,i,n,h){e.call(this,t,i,n,h),this._stuckChildren=[]}i.prototype.root=null,i.prototype.insert=function(t){if(t instanceof Array)for(var i=t.length,e=0;i>e;e++)this.root.insert(t[e]);else this.root.insert(t)},i.prototype.clear=function(){this.root.clear()},i.prototype.retrieve=function(t){var i=this.root.retrieve(t).slice(0);return i},e.prototype.nodes=null,e.prototype._classConstructor=e,e.prototype.children=null,e.prototype._bounds=null,e.prototype._depth=0,e.prototype._maxChildren=4,e.prototype._maxDepth=4,e.TOP_LEFT=0,e.TOP_RIGHT=1,e.BOTTOM_LEFT=2,e.BOTTOM_RIGHT=3,e.prototype.insert=function(t){if(this.nodes.length){var i=this._findIndex(t);return this.nodes[i].insert(t),void 0}this.children.push(t);var e=this.children.length;if(!(this._depth>=this._maxDepth)&&e>this._maxChildren){this.subdivide();for(var n=0;e>n;n++)this.insert(this.children[n]);this.children.length=0}},e.prototype.retrieve=function(t){if(this.nodes.length){var i=this._findIndex(t);return this.nodes[i].retrieve(t)}return this.children},e.prototype._findIndex=function(t){var i=this._bounds,n=t.x>i.x+i.width/2?!1:!0,h=t.y>i.y+i.height/2?!1:!0,s=e.TOP_LEFT;return n?h||(s=e.BOTTOM_LEFT):s=h?e.TOP_RIGHT:e.BOTTOM_RIGHT,s},e.prototype.subdivide=function(){var t=this._depth+1,i=this._bounds.x,n=this._bounds.y,h=0|this._bounds.width/2,s=0|this._bounds.height/2,o=i+h,r=n+s;this.nodes[e.TOP_LEFT]=new this._classConstructor({x:i,y:n,width:h,height:s},t),this.nodes[e.TOP_RIGHT]=new this._classConstructor({x:o,y:n,width:h,height:s},t),this.nodes[e.BOTTOM_LEFT]=new this._classConstructor({x:i,y:r,width:h,height:s},t),this.nodes[e.BOTTOM_RIGHT]=new this._classConstructor({x:o,y:r,width:h,height:s},t)},e.prototype.clear=function(){this.children.length=0;for(var t=this.nodes.length,i=0;t>i;i++)this.nodes[i].clear();this.nodes.length=0},n.prototype=new e,n.prototype._classConstructor=n,n.prototype._stuckChildren=null,n.prototype._out=[],n.prototype.insert=function(t){if(this.nodes.length){var i=this._findIndex(t),e=this.nodes[i];return t.x>=e._bounds.x&&t.x+t.width<=e._bounds.x+e._bounds.width&&t.y>=e._bounds.y&&t.y+t.height<=e._bounds.y+e._bounds.height?this.nodes[i].insert(t):this._stuckChildren.push(t),void 0}this.children.push(t);var n=this.children.length;if(!(this._depth>=this._maxDepth)&&n>this._maxChildren){this.subdivide();for(var h=0;n>h;h++)this.insert(this.children[h]);this.children.length=0}},n.prototype.getChildren=function(){return this.children.concat(this._stuckChildren)},n.prototype.retrieve=function(t){var i=this._out;if(i.length=0,this.nodes.length){var e=this._findIndex(t);i.push.apply(i,this.nodes[e].retrieve(t))}return i.push.apply(i,this._stuckChildren),i.push.apply(i,this.children),i},n.prototype.clear=function(){this._stuckChildren.length=0,this.children.length=0;var t=this.nodes.length;if(t){for(var i=0;t>i;i++)this.nodes[i].clear();this.nodes.length=0}},n.prototype.getChildCount,t.QuadTree=i}(window);